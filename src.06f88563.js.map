{"version":3,"sources":["fps.ts","shaders.ts","index.ts"],"names":[],"mappings":"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","file":"src.06f88563.js","sourceRoot":"..\\src","sourcesContent":["var lastTime = new Date()\r\nvar lastFps: string\r\nvar frames = 0\r\n\r\nexport function getFPS() {\r\n    frames++\r\n    var thisTime = new Date()\r\n    const msec = thisTime.getTime() - lastTime.getTime()\r\n    if (msec >= 1000) {\r\n        lastFps = Math.round(frames * 1000 / msec) + ' fps'\r\n        lastTime = thisTime\r\n        frames = 0\r\n    }\r\n    return lastFps\r\n}","import { gl } from \"./index\"\r\n\r\nfunction compileShader(shaderSource: string, shaderType: GLuint) {\r\n    // Create the shader object\r\n    var shader = gl.createShader(shaderType)!;\r\n\r\n    // Set the shader source code.\r\n    gl.shaderSource(shader, shaderSource);\r\n\r\n    // Compile the shader\r\n    gl.compileShader(shader);\r\n\r\n    // Check if it compiled\r\n    var success = gl.getShaderParameter(shader, gl.COMPILE_STATUS);\r\n    if (!success) {\r\n        // Something went wrong during compilation; get the error\r\n        throw \"could not compile shader:\" + gl.getShaderInfoLog(shader);\r\n    }\r\n\r\n    return shader;\r\n}\r\n\r\nfunction createProgram(vertexShader: WebGLShader, fragmentShader: WebGLShader) {\r\n    // create a program.\r\n    var program = gl.createProgram()!;\r\n\r\n    // attach the shaders.\r\n    gl.attachShader(program, vertexShader);\r\n    gl.attachShader(program, fragmentShader);\r\n\r\n    // link the program.\r\n    gl.linkProgram(program);\r\n\r\n    // Check if it linked.\r\n    var success = gl.getProgramParameter(program, gl.LINK_STATUS);\r\n    if (!success) {\r\n        // something went wrong with the link\r\n        throw (\"program failed to link:\" + gl.getProgramInfoLog(program));\r\n    }\r\n\r\n    return program;\r\n};\r\n\r\nasync function createShaderFromScript(scriptId: string, opt_shaderType: GLuint) {\r\n    var x = await fetch(scriptId)\r\n    var shaderSource = await x.text()\r\n    shaderSource = '#version 300 es\\n' + shaderSource\r\n    return compileShader(shaderSource, opt_shaderType);\r\n};\r\n\r\nexport async function createProgramFromScripts(shaderScriptId: string) {\r\n    var vertexShader = await createShaderFromScript(shaderScriptId+'.vert', gl.VERTEX_SHADER);\r\n    var fragmentShader = await createShaderFromScript(shaderScriptId+'.frag', gl.FRAGMENT_SHADER);\r\n    return createProgram(vertexShader, fragmentShader);\r\n}","import { getFPS } from './fps';\r\nimport { createProgramFromScripts } from './shaders'\r\n\r\nexport var gl: WebGL2RenderingContext\r\nvar paused = true\r\nvar size = 2\r\nconst uniforms: {\r\n    slices?: WebGLUniformLocation\r\n} = {}\r\n\r\nwindow.onload = async () => {\r\n    document.addEventListener('keydown', onKeyDown)\r\n    const canvas = document.querySelector(\"#glCanvas\") as HTMLCanvasElement\r\n    gl = canvas!.getContext(\"webgl2\")!\r\n    if (gl === null) {\r\n        alert(\"Unable to initialize WebGL. Your browser or machine may not support it.\")\r\n        return\r\n    }\r\n    const prog = await createProgramFromScripts('shader')\r\n    gl.useProgram(prog)\r\n    uniforms.slices = gl.getUniformLocation(prog, 'slices')!\r\n    var image = new Image();\r\n    image.crossOrigin = 'anonymous'\r\n    image.src = \"https://upload.wikimedia.org/wikipedia/commons/9/9a/512x512_Dissolve_Noise_Texture.png\"\r\n    image.addEventListener('load', function () {\r\n        const texture = gl.createTexture()\r\n        gl.bindTexture(gl.TEXTURE_2D, texture);\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);\r\n        gl.generateMipmap(gl.TEXTURE_2D);\r\n        window.requestAnimationFrame(step);\r\n    });\r\n}\r\n\r\nfunction step() {\r\n    const fps = document.querySelector(\"#fps\") as HTMLSpanElement;\r\n    fps.textContent = getFPS()\r\n    const sizeSpan = document.querySelector(\"#size\") as HTMLSpanElement;\r\n    sizeSpan.textContent = 'Size: ' + size\r\n    const canvas = document.querySelector(\"#glCanvas\") as HTMLCanvasElement;\r\n    resizeCanvasToDisplaySize(canvas)\r\n    gl.clearColor(0.0, 0.3+0*new Date().getMilliseconds() / 1000, 0.0, 1.0)\r\n    gl.clear(gl.COLOR_BUFFER_BIT)\r\n    gl.enable(gl.BLEND)\r\n    gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA)\r\n    //for (var i = 0; i < size; i++) {\r\n        gl.uniform1f(uniforms.slices!, size)\r\n        gl.drawArraysInstanced(gl.TRIANGLE_STRIP, 0, 4, size)\r\n    //}\r\n    if (paused) return\r\n    window.requestAnimationFrame(step);\r\n}\r\n\r\nfunction onKeyDown(e: KeyboardEvent) {\r\n    switch (e.key) {\r\n        case ' ':\r\n            paused = !paused\r\n            const checkbox = document.querySelector(\"#paused\") as HTMLInputElement\r\n            checkbox.checked = paused\r\n            if (!paused) window.requestAnimationFrame(step)\r\n            break\r\n        case 'ArrowUp':\r\n            //size *= 2\r\n            size++\r\n            break\r\n        case 'ArrowDown':\r\n            //if (size>1) size /= 2\r\n            if (size>1) size--\r\n            break\r\n        default:\r\n            //console.log(e)\r\n    }\r\n    if (paused) window.requestAnimationFrame(step);\r\n}\r\n\r\nfunction resizeCanvasToDisplaySize(canvas: HTMLCanvasElement) {\r\n    const dpr = window.devicePixelRatio;\r\n    const { width, height } = canvas.getBoundingClientRect();\r\n    const displayWidth = Math.round(width * dpr);\r\n    const displayHeight = Math.round(height * dpr);\r\n\r\n    // Check if the canvas is not the same size.\r\n    const needResize = canvas.width != displayWidth ||\r\n        canvas.height != displayHeight;\r\n\r\n    if (needResize) {\r\n        // Make the canvas the same size\r\n        canvas.width = displayWidth;\r\n        canvas.height = displayHeight;\r\n        gl.viewport(0, 0, displayWidth, displayHeight)\r\n    }\r\n\r\n    return needResize;\r\n}"]}